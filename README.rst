dtool lookup webapp
===================

.. image:: https://github.com/livMatS/dtool-lookup-webapp/actions/workflows/build-and-test.yml/badge.svg
    :target: https://github.com/livMatS/dtool-lookup-webapp/actions/workflows/build-and-test.yml
    :alt: dtool-lookup-webapp build and test

.. image:: https://img.shields.io/badge/License-MIT-yellow.svg
    :target: https://opensource.org/licenses/MIT
    :alt: License: MIT

- GitHub repository: https://github.com/jic-dtool/dtool-lookup-webapp
- License: MIT License (https://opensource.org/licenses/MIT)

This web application allows querying and displaying information about datasets stored in one or more base URIs.

Dependencies
------------

The web application requires two other web services:

1. dtool-lookup-server: https://github.com/jic-dtool/dtool-lookup-server - Provides a means to search and display dataset metadata.
2. token-generator-ldap: https://github.com/jic-dtool/token-generator-ldap - Facilitates user authentication.

Setup
-----

Navigate to the `dtool-lookup-webapp` directory:

.. code-block:: bash

    cd dtool-lookup-webapp

Create a `.env` file in the `dtool-lookup-webapp` directory with the following contents:

.. code-block:: bash

    VUE_APP_DTOOL_LOOKUP_SERVER_URL="http://localhost:5000"
    VUE_APP_DTOOL_LOOKUP_SERVER_TOKEN_GENERATOR_URL="http://localhost:5001/token"

For deployment, replace these URLs with the actual endpoints of the lookup server and the token generator.

Customization options for the landing page are available through the following environment variables in the `.env` file:

.. code-block:: text

   VUE_APP_FIRST_CONTAINER_TITLE=Log in
   VUE_APP_SECOND_CONTAINER_TITLE=dserver
   VUE_APP_SECOND_CONTAINER_MESSAGE=Welcome to <b>dserver</b>'s webapp.
   VUE_APP_THIRD_CONTAINER_HEADING=Access
   VUE_APP_THIRD_CONTAINER_MESSAGE=Some notes on how to gain access.
   VUE_APP_FOURTH_CONTAINER_HEADING=Docs
   VUE_APP_FOURTH_CONTAINER_INTRO=Some notes on how to find help. The following list may contain an arbitrary number of links.
   VUE_APP_FOURTH_CONTAINER_RESOURCES=[{"text": "dtool-lookup-webapp repository", "url": "https://github.com/jic-dtool/dtool-lookup-webapp"}]
   VUE_APP_LANDING_PAGE_ICON_PATH=/path/to/custom/icon.png

To apply changes to the `.env` file, execute:

.. code-block:: bash

    npm install

Development Server
------------------

To start a development server:

.. code-block:: bash

    cd dtool-lookup-webapp
    npm run serve

Building for Production
-----------------------

To compile the application into a static single-page website:

.. code-block:: bash

    cd dtool-lookup-webapp
    npm run build

Fixing Broken Installations
---------------------------

To address issues with dependencies in a broken installation:

.. code-block:: bash

    rm -rf dist/ node_modules/
    rm package-lock.json

Then, reinstall the Vue CLI service and rebuild:

.. code-block:: bash

    npm install @vue/cli-service
    npm run build

Testing
-------

Testing requires the `jest.config.js` configuration file, which can be auto-generated by:

.. code-block:: bash

    vue add unit-jest

This step follows the global installation of the Vue CLI:

.. code-block:: bash

    npm install -g @vue/cli

Additional Information
----------------------

For more details on development and build processes, refer to the `README.md` file within the `dtool-lookup-webapp` directory. For deployment instructions using Ansible, consult the `provision/README.rst`.
